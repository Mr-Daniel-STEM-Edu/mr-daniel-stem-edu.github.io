<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Combustion and Oxidation Simulation - The Nouveau Way">
  <meta name="author" content="Mr. Daniel Bishoy">
  <title>Combustion & Redox Lab | The Nouveau Way</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/animejs@3/lib/anime.min.js"></script>

  <style>
    :root {
      --primary: #4361ee;
      --primary-soft: rgba(67, 97, 238, 0.1);
      --nu-gradient: linear-gradient(135deg, #4361ee, #4cc9f0);
      --bg: #f8fafc;
      --text: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --glass: rgba(255, 255, 255, 0.9);
    }
    
    * { box-sizing: border-box; }
    body { margin:0; font-family:'Inter',sans-serif; background:var(--bg); color:var(--text); line-height: 1.6; }

    /* HEADER */
    .nouveau-header {
      position: sticky; top: 0; z-index: 1000;
      background: var(--glass); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 0.75rem 0;
    }
    .header-bar {
      max-width: 1200px; margin: 0 auto; padding: 0 1.5rem;
      display: flex; justify-content: space-between; align-items: center;
    }
    .logo-area { display: flex; align-items: center; gap: 1rem; text-decoration: none; color: inherit; }
    .logo-box {
      width: 42px; height: 42px; background: var(--nu-gradient);
      border-radius: 12px; color: white; display: grid; place-items: center; font-size: 1.2rem; flex-shrink: 0;
    }
    .brand-name { font-family: 'Outfit', sans-serif; font-weight: 800; font-size: 1.5rem; letter-spacing: -0.02em; }
    
    .back-btn {
      display: inline-flex; align-items: center; gap: 0.5rem;
      padding: 0.6rem 1.2rem; border-radius: 12px;
      text-decoration: none; font-weight: 600; font-size: 0.9rem;
      background: white; border: 1px solid var(--border); color: var(--text);
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    .back-btn:hover { border-color: var(--primary); color: var(--primary); transform: translateX(-2px); }

    /* LAYOUT */
    .sim-container { max-width: 1200px; margin: 0 auto; padding: 2rem 1.5rem; min-height: 80vh; display:flex; align-items:center; }
    .sim-row { display: flex; flex-direction: column; gap: 2rem; width: 100%; }
    
    @media(min-width: 992px) {
      .sim-row { flex-direction: row; align-items: flex-start; gap: 4rem; }
    }

    .sim-info { flex: 1; }
    .sim-info h2 { font-family: 'Outfit', sans-serif; margin: 0.5rem 0 1rem; font-size: 2.25rem; font-weight: 800; }
    .sim-tag { 
      display: inline-block; background: var(--primary-soft); color: var(--primary); 
      padding: 0.4rem 1rem; border-radius: 20px; font-weight: 600; font-size: 0.85rem; margin-bottom: 0.5rem;
    }
    
    /* CANVAS BOX */
    .canvas-box {
      flex: 1.5; background: #0f172a; border-radius: 24px; 
      aspect-ratio: 16/9; position: relative; overflow: hidden;
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
      display: flex; align-items: center; justify-content: center;
    }
    .canvas-box::before {
      content: ''; position: absolute; inset:0; pointer-events: none;
      background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
      background-size: 20px 20px;
    }
    canvas { display: block; width: 100%; height: 100%; position: relative; z-index: 1; }

    /* HUD */
    .hud {
      position: absolute; top: 15px; left: 15px; pointer-events: none;
      font-family: 'Courier New', monospace; font-weight: bold; font-size: 13px;
      color: rgba(255,255,255,0.9); text-shadow: 0 2px 4px rgba(0,0,0,0.8);
      white-space: pre-line; z-index: 10;
      background: rgba(0,0,0,0.4); padding: 12px; border-radius: 8px;
      border-left: 3px solid var(--primary);
      backdrop-filter: blur(4px);
    }

    /* CONTROLS */
    .controls {
      margin-top: 1.5rem; background: #fff; padding: 1.5rem;
      border: 1px solid var(--border); border-radius: 12px;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02);
    }
    .ctrl-group { margin-bottom: 1rem; }
    
    .ctrl-header { 
      display: flex; justify-content: space-between; align-items: center;
      font-weight: 600; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text); 
    }
    .ctrl-val { 
      font-family: 'Courier New', monospace; color: var(--primary); 
      font-weight: 700; background: var(--primary-soft); 
      padding: 2px 8px; border-radius: 6px;
    }
    
    input[type=range] { width: 100%; accent-color: var(--primary); cursor: pointer; height: 6px; border-radius: 3px; }
    
    button.btn-primary {
      width: 100%; padding: 12px; background: var(--primary); color: white;
      border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 0.95rem;
      transition: all 0.2s;
      display: flex; align-items: center; justify-content: center; gap: 0.5rem;
    }
    button.btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
    button.btn-primary.active { background: #ef4444; }

    footer { text-align: center; padding: 3rem; border-top: 1px solid var(--border); margin-top: auto; background: #fff; }

    @media (max-width: 768px) {
      .canvas-box { aspect-ratio: 4/3; } 
      .sim-row { flex-direction: column; gap: 2rem; }
    }
  </style>
</head>
<body>

  <header class="nouveau-header">
    <div class="header-bar">
      <a href="#" class="logo-area">
        <div class="logo-box"><i class="fas fa-atom"></i></div>
        <span class="brand-name">The Nouveau Way</span>
      </a>
      <a href="explore.html" class="back-btn">
        <i class="fas fa-arrow-left"></i> Back to Library
      </a>
    </div>
  </header>

  <main class="sim-container">
      <section class="sim-row animate-in">
        <div class="sim-info">
          <span class="sim-tag">Particle Thermodynamics</span>
          <h2>Combustion & Redox Lab</h2>
          <p>Explore the <strong>Fire Triangle</strong> and <strong>Oxidation</strong>. Adjust the air intake to switch between incomplete (yellow) and complete (blue) combustion.</p>
          
          <div style="margin-bottom: 1.5rem; background:white; padding:1rem; border-radius:8px; border:1px solid var(--border);">
             <p style="margin:0; font-size:0.9rem; color:var(--text-muted);">
               <strong>Experiment:</strong> Observe how flame temperature affects the oxidation of Copper:
             </p>
             <div style="text-align:center; margin-top:0.5rem; font-size:1.1rem; font-family:serif;">
               <span id="math-target">2Cu + O₂ &rarr; 2CuO</span>
             </div>
          </div>
          
          <div id="ctrl-panel" class="controls"></div>
        </div>

        <div class="canvas-box">
          <div id="hud-display" class="hud"></div>
          <canvas id="sim-canvas"></canvas>
        </div>
      </section>
  </main>

  <footer>
    <div class="logo-box" style="margin: 0 auto 1rem; color:white;"><i class="fas fa-atom"></i></div>
    <h3>The Nouveau Way</h3>
    <p>Advanced Physics Simulation Platform</p>
    <p style="margin-top: 1rem; font-size: 0.85rem; color: var(--text-muted);">&copy; 2026 Mr Daniel Bishoy. Engineered for Excellence.</p>
  </footer>

<script>
/* =========================================
   SIMULATION LOGIC
   ========================================= */

// 1. GLOBAL STATE
const state = {
  gas: 60,      // Fuel Flow %
  air: 20,      // Air Intake % (0 = Closed/Yellow, 100 = Open/Blue)
  copper: false // Is copper strip inserted?
};

// Physics Vars
let particles = [];
let copperOxidation = 0; // 0.0 to 1.0
let flameTemp = 0;       
let lastTime = 0;

// Canvas Refs
let canvas = null;
let ctx = null;
let w = 800;
let h = 600;

// 2. CONTROLS
function createSlider(label, val, min, max, callback) {
  const group = document.createElement('div');
  group.className = 'ctrl-group';
  
  const header = document.createElement('div');
  header.className = 'ctrl-header';
  const valSpan = document.createElement('span');
  valSpan.className = 'ctrl-val';
  valSpan.innerText = val + '%';
  
  header.innerHTML = `<span>${label}</span>`;
  header.appendChild(valSpan);
  
  const input = document.createElement('input');
  input.type = 'range'; input.min = min; input.max = max; input.value = val;
  
  input.oninput = (e) => {
    const v = parseFloat(e.target.value);
    valSpan.innerText = v + '%';
    callback(v);
  };
  
  group.appendChild(header);
  group.appendChild(input);
  return group;
}

function initControls() {
  const panel = document.getElementById('ctrl-panel');
  if(!panel) return;
  panel.innerHTML = '';
  
  // Slider 1: Gas
  panel.appendChild(createSlider('Gas Flow (Fuel)', state.gas, 0, 100, (v) => state.gas = v));
  
  // Slider 2: Air
  panel.appendChild(createSlider('Air Intake (Oxygen)', state.air, 0, 100, (v) => state.air = v));
  
  // Button: Copper
  const btnGroup = document.createElement('div');
  btnGroup.className = 'ctrl-group';
  const btn = document.createElement('button');
  btn.className = 'btn-primary';
  btn.innerHTML = '<i class="fas fa-flask"></i> Insert Copper Strip';
  btn.onclick = () => {
    state.copper = !state.copper;
    if(state.copper) {
        btn.classList.add('active');
        btn.innerHTML = '<i class="fas fa-times"></i> Remove Copper Strip';
        if(copperOxidation >= 0.95) copperOxidation = 0; // Reset for replay
    } else {
        btn.classList.remove('active');
        btn.innerHTML = '<i class="fas fa-flask"></i> Insert Copper Strip';
    }
  };
  btnGroup.appendChild(btn);
  panel.appendChild(btnGroup);
}

// 3. PHYSICS & DRAW LOOP
function spawnParticle(airFactor) {
  const nozzleX = w / 2;
  const nozzleY = h - 60;
  const isComplete = airFactor > 0.4;
  
  // Color: Low air = Yellow, High air = Blue
  let r, g, b;
  if(airFactor < 0.5) {
      r = 255; 
      g = Math.floor(150 + Math.random()*100); 
      b = 50;
  } else {
      r = 50;
      g = Math.floor(150 + Math.random()*100);
      b = 255;
  }
  
  const spread = (1.2 - airFactor) * 30; 
  const speed = 100 + (state.gas * 2) + (airFactor * 100); 

  particles.push({
    x: nozzleX + (Math.random() - 0.5) * 15,
    y: nozzleY,
    vx: (Math.random() - 0.5) * spread,
    vy: -speed * (0.8 + Math.random()*0.4),
    life: 0.8 + Math.random() * 0.4,
    maxLife: 1.2,
    size: 15 + Math.random() * 10,
    color: `rgb(${r},${g},${b})`,
    isSoot: !isComplete && Math.random() > 0.7
  });
}

function updatePhysics(dt) {
  if(dt > 0.1) dt = 0.1; // Cap time step

  const airFactor = state.air / 100;
  const fuelFactor = state.gas / 100;
  
  // Temp approximation: Complete combustion is hotter
  const efficiency = 0.3 + (airFactor * 0.7); 
  flameTemp = 200 + (fuelFactor * 800 * efficiency); 

  // Spawn
  const particlesToSpawn = Math.floor(state.gas / 10); 
  for(let i=0; i<particlesToSpawn; i++) spawnParticle(airFactor);

  // Update Particles
  for (let i = particles.length - 1; i >= 0; i--) {
    let p = particles[i];
    p.life -= dt;
    if(p.isSoot) {
        p.vx += (Math.random()-0.5) * 20 * dt; 
        p.x += p.vx * dt;
        p.y += p.vy * dt * 0.8; 
    } else {
        p.x += p.vx * dt;
        p.y += p.vy * dt;
    }
    p.size -= dt * 10;
    if (p.life <= 0 || p.size <= 0) particles.splice(i, 1);
  }

  // Oxidation: 2Cu + O2 -> 2CuO
  // Requires heat
  if (state.copper && flameTemp > 300) {
    copperOxidation += dt * 0.2 * (flameTemp/1000);
    if(copperOxidation > 1) copperOxidation = 1;
  }
}

function draw() {
  if(!ctx) return;
  ctx.clearRect(0, 0, w, h);
  
  const nozzleX = w / 2;
  const nozzleY = h - 60;

  // Draw Burner
  ctx.fillStyle = '#475569';
  ctx.fillRect(nozzleX - 15, nozzleY, 30, 60); 
  ctx.fillStyle = '#1e293b';
  ctx.fillRect(nozzleX - 25, h - 10, 50, 10); 
  
  // Air Intake Animation
  const holeHeight = (state.air / 100) * 15;
  ctx.fillStyle = '#0f172a'; 
  ctx.fillRect(nozzleX - 8, nozzleY + 30, 16, 15); 
  ctx.fillStyle = '#94a3b8'; 
  ctx.fillRect(nozzleX - 9, nozzleY + 30, 18, 15 - holeHeight); 

  // Draw Fire
  ctx.globalCompositeOperation = 'screen'; 
  particles.forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    const alpha = p.life / p.maxLife;
    ctx.fillStyle = p.isSoot ? `rgba(100,100,100,${alpha})` : p.color.replace(')', `, ${alpha})`);
    ctx.fill();
  });
  ctx.globalCompositeOperation = 'source-over';

  // Draw Copper
  if (state.copper) {
    ctx.save();
    ctx.translate(nozzleX + 80, nozzleY - 120);
    ctx.rotate(-0.2);
    
    // Tongs
    ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = 5;
    ctx.beginPath(); ctx.moveTo(100, 0); ctx.lineTo(0, 0); ctx.stroke();
    
    // Strip Color: Cu to CuO
    const r = 184 - (160 * copperOxidation);
    const g = 115 - (100 * copperOxidation);
    const b = 51 - (40 * copperOxidation);
    
    ctx.fillStyle = `rgb(${Math.floor(r)},${Math.floor(g)},${Math.floor(b)})`;
    ctx.fillRect(-60, -10, 60, 20);
    
    ctx.fillStyle = 'white'; ctx.font = 'bold 12px sans-serif';
    ctx.fillText(copperOxidation > 0.8 ? "CuO (Oxide)" : "Cu (Metal)", -50, -15);
    ctx.restore();
  }

  updateHUD();
}

function updateHUD() {
  const hud = document.getElementById('hud-display');
  if(!hud) return;

  const isComplete = state.air > 35; 
  let html = `<span style="color:#94a3b8">SIMULATION DATA</span><br>`;
  html += `Flame Temp: <span style="color:${isComplete?'#4cc9f0':'#facc15'}">${Math.floor(flameTemp)} °C</span><br>`;
  html += `Combustion: ${isComplete ? 'Complete (Blue)' : 'Incomplete (Yellow)'}<br>`;
  
  if(state.copper) {
    html += `<br><span style="color:#94a3b8">REACTION STATUS</span><br>`;
    html += `Material: Copper<br>`;
    html += `Oxidation: ${(copperOxidation * 100).toFixed(0)}%<br>`;
    if(copperOxidation > 0.9) html += `<span style="color:#22c55e">Reaction Complete: CuO</span>`;
  }
  hud.innerHTML = html;
}

// 4. MAIN LOOP & INIT
function loop(timestamp) {
  if (!lastTime) lastTime = timestamp;
  const dt = (timestamp - lastTime) / 1000;
  lastTime = timestamp;
  
  updatePhysics(dt);
  draw();
  requestAnimationFrame(loop);
}

function resize() {
  canvas = document.getElementById('sim-canvas');
  if(canvas) {
    ctx = canvas.getContext('2d');
    const parent = canvas.parentElement;
    w = parent.clientWidth;
    h = parent.clientHeight;
    canvas.width = w;
    canvas.height = h;
  }
}

// 5. IMMEDIATE START (Fixes "Starting Engine" freeze)
(function startSim() {
  // A. Init Canvas & Controls
  resize();
  window.addEventListener('resize', resize);
  initControls();
  
  // B. Start Loop
  requestAnimationFrame(loop);
  
  // C. Optional: Attempt LaTeX Render nicely
  try {
    if (window.katex) {
        katex.render("2Cu + O_2 \\xrightarrow{\\Delta} 2CuO", document.getElementById('math-target'));
    }
  } catch(e) {}

  // D. Optional: UI Animation
  if(window.anime) {
    anime({ targets: '.animate-in', opacity: [0, 1], translateY: [20, 0], duration: 800, easing: 'easeOutQuad' });
  }
})();
</script>
</body>
</html>